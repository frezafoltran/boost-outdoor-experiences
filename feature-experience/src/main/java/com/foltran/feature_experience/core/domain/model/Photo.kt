package com.foltran.feature_experience.core.domain.model

import com.foltran.core_experience.shared.data.model.Photo
import kotlin.collections.Map
import kotlin.math.abs

fun Photo.toWebViewPhoto() = com.foltran.core_map.webview.Photo(
    id = this.id,
    lat = this.lat,
    lon = this.lon,
    indexInStream = this.indexInStream
)

fun List<Photo>.toWebViewPhotos() = this.map{ it.toWebViewPhoto() }

fun Photo.toMapIcon() = com.foltran.core_map.core.models.icon.MapIcon(
    id = this.id,
    lat = this.lat,
    lon = this.lon,
    indexInStream = this.indexInStream,
    base64 = "data:image/png;base64,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"
)

fun List<Photo>.toMapIcons() = this.map{ it.toMapIcon() }

//fun List<Photo>.toWebViewPhotoMapByLatLng() =
//    this.map { latLonPairToId(it.lat, it.lon) to it.toWebViewPhoto() }.toMap()

fun List<Photo>?.toWebViewPhotoMapById() =
    this?.map { it.id to it.toWebViewPhoto() }?.toMap() ?: emptyMap()

fun Map<String, com.foltran.core_map.webview.Photo>?.photoIdByLatLng(
    lat: Double?,
    lng: Double?,
    uncertainty: Double = 0.0
): String? =
    if (lat == null || lng == null) null
    else this?.filter {
        abs(it.value.lat - lat) <= uncertainty && abs(it.value.lon - lng) <= uncertainty
    }?.keys?.firstOrNull()

fun Map<String, com.foltran.core_map.webview.Photo>?.photoIdByUrl(
    url: String?
): String? =
    if (url.isNullOrEmpty()) null
    else this?.filter {
        it.value.url == url
    }?.keys?.firstOrNull()
